<section class="main">
    <div class="container">
        <div class="row">
            <div class="col-md-8 col-sm-8">
                <div class="row">
                    <div class="col-md-12">

                        <div class="post">
                            <div class="post-price">
                                <%= @voiture.prix %> Dhs
                            </div>
                            <div class="post-title">
                                <h2><%= "#{@voiture.marque} #{@voiture.modele}" %></h2>
                            </div>
                            <div class="post-meta">
                                <ul>
                                    <li><i class="fa fa-clock-o"></i>
                                        Il y'a <%= time_ago_in_words(@voiture.created_at) %>
                                    <li><i class="fa fa-map-marker"></i> <%= @voiture.ville %></li>
                                </ul>
                            </div>
                            <div class="flexslider post-images">
                                <ul class="slides">
                                <% if @photos %>
                                    <% @photos.each do |photo| %>
                                        <li data-thumb="<%= photo.image.url() %>">
                                            <img alt="" src=" <%= photo.image.url() %>" />

                                        </li>
                                <% end %>
                                <% end %>
                                </ul>
                            </div>
                            <div class="row text-center row-space-1">
                            <div class="col-sm-4">
                                <i class="fa fa-users fa-2x"></i>
                            </div>
                            <div class="col-sm-4">
                                <i class="fa fa-car fa-2x"></i>
                            </div>
                            <div class="col-sm-4">
                                <i class="fa fa-tachometer fa-2x"></i>
                            </div>
                            </div>
                            <div class="row text-center">
                                <div class="col-sm-4">
                                    <%= @voiture.nb_places %> <%= @voiture.nb_places > 1? "Places" : "Place" %>
                                </div>
                                <div class="col-sm-4">
                                    <%= @voiture.nb_portes %> <%= @voiture.nb_portes > 1? "Portes" : "Porte" %>
                                </div>
                                <div class="col-sm-4">
                                    <%= @voiture.kilometrage %>
                                </div>
                            </div>
                            <div class="post-body">
                                <h4><strong>Accessoires</strong></h4>
                                <div class="row">
                                    <div class="col-md-6">
                                        <ul class="amenities">
                                            <li class="<%= 'text-line-through' if !@voiture.is_clim %>">Climatiseur</li>
                                            <li class="<%= 'text-line-through' if !@voiture.is_direction_assiste %>">Direction assistee</li>
                                            <li class="<%= 'text-line-through' if !@voiture.is_regulateur_vitesse %>">Regulateur de vitesse</li>
                                        </ul>
                                    </div>
                                    <div class="col-md-6">
                                        <li class="<%= 'text-line-through' if !@voiture.is_gps %>">GPS</li>
                                        <li class="<%= 'text-line-through' if !@voiture.is_lecteur_cd %>">Lecteur CD</li>
                                        <li class="<%= 'text-line-through' if !@voiture.is_audio_input %>">Audio input</li>
                                    </div>
                                </div>
                                <h4>Peut être retourné à</h4>
                                 <div class="row">
                                    <div class="col-md-6">
                                        <ul class="amenities">
                                            <li class="<%= 'text-line-through' if !@voiture.is_return_marrakech %>">Marrakech</li>
                                            <li class="<%= 'text-line-through' if !@voiture.is_return_agadir %>">Agadir</li>
                                            <li class="<%= 'text-line-through' if !@voiture.is_return_casablanca %>">Casablanca</li>
                                        </ul>
                                    </div>
                                    <div class="col-md-6">
                                        <li class="<%= 'text-line-through' if !@voiture.is_return_kenitra %>">Kenitra</li>
                                        <li class="<%= 'text-line-through' if !@voiture.is_return_laayoun %>">Laayoun</li>
                                        <li class="<%= 'text-line-through' if !@voiture.is_return_fes %>">Fes</li>
                                    </div>
                                </div>
                                <h4><strong>Conditions</strong></h4>
                                <p>
                                    <%= @voiture.description %>
                                </p>
                            </div>
                            <div class="post-footer">
                                <div class="row">
                                    <div class="col-xs-6">    
                                        <button id="shownum2" class="btn btn-info" data-toggle="modal" data-target="#popupnum"><i class="fa fa-whatsapp"></i> <span class="hidden-xs hidden-sm">Afficher numéro</span></button>
                                        <button class="btn btn-warning" data-target="#popupemail" data-toggle="modal"><i class="fa fa-envelope"></i> <span class="hidden-xs hidden-sm">Envoyer email</span></button>
                                    </div>
                                    <div class="col-xs-6">
                                        <div class="item-action pull-right">
                                            <ul>
                                                <li><a href="#" data-toggle="tooltip" data-placement="top" title="Show Details" class="btn btn-success btn"><i class="fa fa-share-alt"></i></a></li>
                                            </ul>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-12">
                        <div class="section-header">
                            <h2>Propositions</h2>
                        </div>
                        <div class="row">
                            <% for voiture in @similaires %>
                            <div class="col-md-4">
                                <div class="item-ads-grid">
                                    <div class="item-img-grid">
                                        <%= image_tag voiture.photos[0].image.url(:medium),class: "img-responsive img-center" %>
                                    </div>
                                    <div class="item-title">
                                        <h4><%= link_to "#{voiture.marque} #{voiture.modele}", voiture %></h4>
                                    </div>
                                    <div class="item-meta">
                                        <ul>
                                            <li class="item-date"><i class="fa fa-clock-o"></i> <%= @voiture.user.created_at.strftime("%v") %></li>
                                            <li class="item-location"><a href="category.html"><i class="fa fa-map-marker"></i><%= voiture.ville %></a></li>
                                        </ul>
                                    </div>
                                    <div class="product-footer">
                                        <div class="item-price-grid pull-left">
                                            <h3><%= voiture.prix %> Dhs</h3>
                                        </div>
                                        <div class="item-action-grid pull-right">
                                            <ul>
                                                <li>
                                                    <%= link_to voiture, {class:"btn btn-success btn-sm"} do %>
                                                        <i class="fa fa-eye"></i>
                                                    <% end %>
                                                    </a>
                                                </li>
                                            </ul>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <% end %>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-4 col-sm-4">
                <div class="widget">
                    <div class="widget-header">
                        <h3>Loueur</h3>
                    </div>
                    <div class="widget-body text-center">
                        <%= image_tag(@voiture.user.avatar.url(:medium), class: "seller-avatar img-responsive") %>
                        <h2 class="seller-name"><%= link_to "#{@voiture.user.name}", voiture.user %></h2>
                        <p class="seller-detail">Email: <strong><%= @voiture.user.email %></strong><br/>
                            Joined : <strong><%= @voiture.user.created_at.strftime("%v") %></strong></p>
                    </div>
                    <div class="widget-footer">
                        <div class="row">
                            <div class="col-sm-6">    
                                <button id="shownum" class="btn btn-info btn-block" data-toggle="modal" data-target="#popupnum"><i class="fa fa-whatsapp"></i> <span class="hidden-xs hidden-sm"></span></button>
                            </div>
                            <div class="col-sm-6">
                                <button class="btn btn-warning btn-block" data-target="#popupemail" data-toggle="modal"><i class="fa fa-envelope"></i> </button>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="widget">
                  <%= render 'reservations/form' %>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- Num Popup -->
<%= render 'shared/popup_num' %>
<!-- bootstrap contact form -->
<%= render 'shared/popup_email' %>
</section>
<script type="text/javascript">
    $(document).ready(function () {

        // ===============Flexslider=====================
        $('.flexslider').flexslider({
            animation: "slide",
            controlNav: "thumbnails",
            directionNav: false,
            start: function (slider) {
                $('body').removeClass('loading');
            }
        });

        // ==========tooltip initial=================
        $('[data-toggle="tooltip"]').tooltip();
    });

//INcrement compteur
function increment_num(){
   $.ajax({
   url: '/increment_num',
   data: {'id': <%= @voiture.id %>},
   method: 'POST'
}); 
}


$('#shownum').on('click',function (){
increment_num();
});
$('#shownum2').on('click',function (){
increment_num();
});


// bootstrap form contact

$.fn.goValidate = function() {
    var $form = this,
        $inputs = $form.find('input:text');
  
    var validators = {
        name: {
            regex: /^[A-Za-z]{3,}$/
        },
        pass: {
            regex: /(?=.*\d)(?=.*[a-z])(?=.*[A-Z]).{6,}/
        },
        email: {
            regex: /^[\w\-\.\+]+\@[a-zA-Z0-9\.\-]+\.[a-zA-z0-9]{2,4}$/
        }
    };
    var validate = function(klass, value) {
        var isValid = true,
            error = '';
            
        if (!value && /required/.test(klass)) {
            error = 'This field is required';
            isValid = false;
        } else {
            klass = klass.split(/\s/);
            $.each(klass, function(i, k){
                if (validators[k]) {
                    if (value && !validators[k].regex.test(value)) {
                        isValid = false;
                        error = validators[k].error;
                    }
                }
            });
        }
        return {
            isValid: isValid,
            error: error
        }
    };
    var showError = function($input) {
        var klass = $input.attr('class'),
            value = $input.val(),
            test = validate(klass, value);
      
        $input.removeClass('invalid');
        $('#form-error').addClass('hide');
        
        if (!test.isValid) {
            $input.addClass('invalid');
            
            if(typeof $input.data("shown") == "undefined" || $input.data("shown") == false){
               $input.popover('show');
            }
            
        }
      else {
        $input.popover('hide');
      }
    };
   
    $inputs.keyup(function() {
        showError($(this));
    });
  
    $inputs.on('shown.bs.popover', function () {
        $(this).data("shown",true);
    });
  
    $inputs.on('hidden.bs.popover', function () {
        $(this).data("shown",false);
    });
  
    $form.submit(function(e) {
      
        $inputs.each(function() {
            if ($(this).is('.required') || $(this).hasClass('invalid')) {
                showError($(this));
            }
        });
        if ($form.find('input.invalid').length) {
            e.preventDefault();
            $('#form-error').toggleClass('hide');
        }
    });
    return this;
};
$('form').goValidate();



</script>